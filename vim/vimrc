" vim:set ts=2 sts=2 sw=2 expandtab:

set nocompatible
filetype off

if !filereadable(expand('~/.vim/autoload/plug.vim'))
  exec 'silent !curl -fLo ~/.vim/autoload/plug.vim --create-dirs '.
        \ 'https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'  
endif

" Plugins
call plug#begin('~/.vim/plugged')
  Plug 'mileszs/ack.vim'
  Plug 'ctrlpvim/ctrlp.vim'
  Plug 'FelikZ/ctrlp-py-matcher'
  Plug 'tacahiroy/ctrlp-funky'
  Plug 'Raimondi/delimitMate'
  Plug 'tpope/vim-sleuth'
  Plug 'henrik/vim-reveal-in-finder'
  Plug 'tpope/vim-eunuch'
  Plug 'shawncplus/phpcomplete.vim'
  " Plug '2072/PHP-Indenting-for-VIm'
  Plug 'vim-scripts/matchit.zip'
  Plug 'tpope/vim-surround' "ds, cs, yss
  Plug 'skwp/greplace.vim'
  Plug 'tomtom/tcomment_vim' "gcc, gc{motion}
  Plug 'groenewege/vim-less'
  Plug 'pbrisbin/vim-mkdir' "Automatically create non-existent directories when saving.
  Plug 'tpope/vim-fugitive'

  Plug 'ntpeters/vim-better-whitespace'
  Plug 'dyng/ctrlsf.vim'
  Plug 'ludovicchabant/vim-gutentags'
  Plug 'terryma/vim-multiple-cursors'
  Plug 'tpope/vim-repeat'
  Plug 'sjl/gundo.vim'
  Plug 'thinca/vim-quickrun'

  Plug 'NLKNguyen/papercolor-theme'
  Plug 'rakr/vim-one'
  Plug 'jalvesaq/southernlights'
  Plug 'colepeters/spacemacs-theme.vim'
call plug#end()

" ----------------------
" 1) General Preferences
" ----------------------

filetype plugin indent on
syntax on
"set omnifunc=syntaxcomplete#Complete

set autoread hidden nobackup nowritebackup noswapfile modeline
set ffs=unix,dos,mac enc=utf-8 fenc=utf-8
set clipboard=unnamed
set report=0
set shortmess=aAI
set incsearch
set relativenumber number
set viminfo='100,<100,s10,h


" Use visual bells instead of sound.
set noerrorbells
set vb t_vb=

" Cursor keys move to prev/next lines too.
set whichwrap+=<,>,[,]

" Default to replacing all ocurrences when searching & replacing.
set gdefault

" Ignore case when searching, except if not all pattern is lowercase.
set ignorecase smartcase

" Show matching brackets.
set showmatch

" Custom status line
set statusline=\ [%{mode()}]\ %.80f\ %h%m%r%w%=\|\%{strlen(&ft)?&ft:'?'}\ \|\%{strlen(&fenc)?&fenc:&enc}\ (%{&fileformat})\|\ %-8(%l:%c%)

" Last line: don't show current mode + show incomplete commands.
set noshowmode showcmd

" Always show status line.
set laststatus=2

set cursorline
set colorcolumn=0

set foldmethod=indent foldlevel=99 foldnestmax=4

" Always show some lines of context around the cursor.
set scrolloff=5

set listchars=tab:\›\ ,trail:·
set list

" set noeol nofixeol

"-----------
" 2) Editing
"-----------

set nostartofline

set nowrap
set textwidth=120

set autoindent smartindent copyindent
set tabstop=4 softtabstop=0 shiftwidth=4
set expandtab smarttab

" Recognize numbered lists.
set formatoptions+=n

" Do not break lines at textwidth col.
set formatoptions-=t

" Backspace over everything.
set backspace=indent,eol,start

" When editing a file, always jump to the last cursor position.
au BufReadPost * if line("'\"") > 1 && line("'\"") <= line("$") | exe "normal! g'\"" | endif

" Autocomplete.
set completeopt=menu,longest,menuone

" Use wild menu for tab-completion.
set wildmenu
set wildmode=longest:full
set wildignore+=.DS_Store,*/node_modules/*,*/vendors/*,*/.site/*,*.min.css,*.min.js,*.mo

" set wildignore+=*/_vvv/*

" ---------------------------
" 3) Filetype-specific config
" ---------------------------
"
au FileType php setl omnifunc=phpcomplete#CompletePHP makeprg=php\ %
au FileType python setl omnifunc=pythoncomplete#Complete makeprg=python\ %
au FileType ruby setl makeprg=ruby\ %

"----------------
" 4) Key bindings
"----------------

let mapleader = ","
noremap Q <nop>

" A more clever navigation.
nnoremap j gj
nnoremap k gk

" Visual shifting.
vnoremap < <gv
vnoremap > >gv

" Remap space bar to search.
:nmap <Space> /

imap jj <Esc>

" Navigate through buffers using Ctrl-Tab and Ctrl-Shift-Tab
map <C-Tab> :bn<CR>
map <C-S-Tab> :bp<CR>

" Ctrl + Space for omnifunc automcplete.
imap <C-Space> <C-X><C-O>


" Typing %% expands to the path of the current file.
cmap %% <C-R>=expand("%:h") . "/" <CR>

" Quicker window switching
nnoremap <C-h> <C-w>h
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-l> <C-w>l

" Fugitive git status
nnoremap <silent> gss :Gstatus<CR>

"-----------
" 5) Plugins
"-----------

let g:tcommentGuessFileType_php=1

let delimitMate_expand_space=1

" Use treeview for NetRW by default.
let g:netrw_liststyle=3

if executable('ag')
  let g:ackprg = 'ag --vimgrep --skip-vcs-ignores --ignore node_modules/ --ignore .git --ignore .DS_Store --ignore vendor/ --ignore tmp/'

  let g:ctrlp_user_command = 'ag %s -l --nocolor --hidden --skip-vcs-ignores --ignore node_modules --ignore .git --ignore .DS_Store --ignore vendor/ --ignore tmp/ -g ""'
  let g:ctrlp_use_caching = 0

  " File search (AG Silver Searcher).
  nnoremap <Leader>a :Ack!<Space>''<Left>
  nnoremap <Leader>A :Ack! <cword><CR>
endif

" ctrlp.vim.
let g:ctrlp_match_window = 'bottom,order:btt,min:1,max:20'
" let g:ctrlp_match_window_bottom = 1
" let g:ctrlp_match_window_reversed = 0
" let g:ctrlp_max_height = 15
let g:ctrlp_show_hidden = 0
let g:ctrlp_match_func = { 'match': 'pymatcher#PyMatch' }
let g:ctrlp_max_files = 0
let g:ctrlp_map = '<Leader>o'
let g:ctrlp_extensions = ['funky']
let g:ctrlp_open_multiple_files = 'ij'
let g:ctrlp_working_path_mode = ''

let g:ctrlsf_auto_close = 0
let g:ctrlsf_position = 'bottom'
" let g:ctrlsf_winsize = '200'

" --------
" 6) Misc.
" --------

" Command to remove trailing spaces.
" command! RemoveTrailingSpaces :%s/\s\+$//e
"

if has("gui_running")
  set linespace=2
  set guicursor=a:blinkon0
  set guioptions=ceig
endif
